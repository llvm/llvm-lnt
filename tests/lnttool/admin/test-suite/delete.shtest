# RUN: rm -rf %t.instance
# RUN: rm -rf %t.tmp && mkdir -p %t.tmp
# RUN: python %{shared_inputs}/create_temp_instance.py \
# RUN:   %s %{shared_inputs}/SmallInstance %t.instance
# RUN: %{shared_inputs}/server_wrapper.sh %t.instance 9096 /bin/sh %s %t.tmp %{shared_inputs}

set -eux
DIR="$1"
SHARED_INPUTS="$2"
cd "$DIR"

cat > lntadmin.yaml << '__EOF__'
lnt_url: "http://localhost:9096"
database: default
testsuite: delete_test_suite
auth_token: test_token
__EOF__

SCHEMA_URL="http://localhost:9096/api/db_default/v4/delete_test_suite/schema"

cat > schema.yaml << '__EOF__'
format_version: '2'
name: delete_test_suite
metrics:
  - name: execution_time
    type: Real
    unit: seconds
run_fields:
  - name: build_revision
    order: true
machine_fields:
  - name: hardware
__EOF__

lnt admin --testsuite delete_test_suite test-suite add schema.yaml > add_schema.stdout 2>&1
# RUN: filecheck %s --check-prefix=ADD_SCHEMA < %t.tmp/add_schema.stdout
# ADD_SCHEMA: delete_test_suite

lnt admin test-suite delete delete_test_suite > delete_schema.stdout 2>&1
# RUN: filecheck %s --check-prefix=DELETE_SCHEMA < %t.tmp/delete_schema.stdout
# DELETE_SCHEMA: delete_test_suite

curl -s -o schema_response.txt -w "%{http_code}" "$SCHEMA_URL" > schema_status.txt 2>&1
# RUN: filecheck %s --check-prefix=SCHEMA_STATUS < %t.tmp/schema_status.txt
# SCHEMA_STATUS: 404
